const baseApiUrl=window.location.origin.includes("localhost")?"http://localhost":"https://grangem-master-cvkurw.laravel.cloud";function checkFavoritesValidity(){let t=JSON.parse(localStorage.getItem("favsItemsList"))||[];if(!t.length)return;const e=t.map((t=>String(t.id).replace(/^product/i,"").replace(/^0+/,""))).join(",");$.ajax({url:`${baseApiUrl}/api/wishlist?products=${e}`,method:"GET",success:function(e){e.map((t=>String(t.id)));t=t.filter((t=>{const i=String(t.id).replace(/^product/i,"").replace(/^0+/,""),s=e.find((t=>String(t.id)===i));if(s){if(s.has_price&&s.price){const e=t.price.replace(/[^\d.,]/g,"").replace(",","."),i=parseFloat(s.price).toFixed(2);parseFloat(e)!==parseFloat(i)&&(t.price=i,$(`.side__item[data-id="${t.id}"]`).find("p").text(i))}return!0}return $(`.side__item[data-id="${t.id}"]`).remove(),$(`#${t.id}`).find(".add-to-fav").removeClass("active"),$(".product__fav").removeClass("active"),!1})),localStorage.setItem("favsItemsList",JSON.stringify(t)),$(".fav-count-number").text(t.length)},error:function(){console.error("Не удалось проверить актуальность избранного")}})}function checkCartValidity(){let t=JSON.parse(localStorage.getItem("cartItemsList"))||[];if(!t.length)return;const e=t.map((t=>String(t.id).replace(/^product/i,"").replace(/^0+/,""))).join(",");$.ajax({url:`${baseApiUrl}/api/cart-products?products=${e}`,method:"GET",success:function(e){t=t.filter((t=>{const i=String(t.id).replace(/^product/i,"").replace(/^0+/,""),s=e.find((t=>String(t.id)===i));if(s){if(s.has_price&&s.price){const e=t.price.replace(/[^\d.,]/g,"").replace(",","."),i=parseFloat(s.price).toFixed(2);parseFloat(e)!==parseFloat(i)&&(t.price=i,$(`.side.cart .side__item[data-id="${t.id}"]`).find("p").text(i))}return!0}return $(`.side.cart .side__item[data-id="${t.id}"]`).remove(),!1})),localStorage.setItem("cartItemsList",JSON.stringify(t)),updateCartCount(),updateCartTotal()},error:function(){console.error("Не удалось проверить актуальность корзины")}})}function renderOrderItems(){let t=JSON.parse(localStorage.getItem("cartItemsList"))||[];if(!t.length)return;const e=$(".order__items");e.empty(),t.forEach((t=>{const i=`\n      <div class="order__item" data-id="${t.id}">\n        <div class="order__img">\n          <picture>\n            <img src="${t.img}" alt="order">\n          </picture>\n        </div>\n        <div class="order__info">\n          <span>${t.code}</span>\n          <div class="order__name">${t.name}</div>\n          <div class="order__drop"></div>\n          <div class="order__price">${t.price}</div>\n        </div>\n        <div class="order__del">\n          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" ...>...</svg>\n        </div>\n      </div>\n    `;e.append(i)}));const i=t.map((t=>String(t.id).replace(/^product/i,"").replace(/^0+/,""))).join(",");$.ajax({url:`${baseApiUrl}/api/cart-products?products=${i}`,method:"GET",success:function(e){t=t.filter((t=>{const i=String(t.id).replace(/^product/i,"").replace(/^0+/,""),s=e.find((t=>String(t.id)===i));if(s){if(s.has_price&&s.price){const e=t.price.replace(/[^\d.,]/g,"").replace(",","."),i=parseFloat(s.price).toFixed(2);parseFloat(e)!==parseFloat(i)&&(t.price=i+" ₸",$(`.side.cart .side__item[data-id="${t.id}"]`).find("p").text(i+" ₸"),$(`.order__item[data-id="${t.id}"]`).find(".order__price").text(i+" ₸"))}return!0}return $(`.side.cart .side__item[data-id="${t.id}"]`).remove(),$(`.order__item[data-id="${t.id}"]`).remove(),!1})),localStorage.setItem("cartItemsList",JSON.stringify(t)),updateCartCount(),updateCartTotal()},error:function(){console.error("Не удалось проверить актуальность корзины")}})}function updateCartTotal(){let t=0;$(".side.cart .side__item--info p").each((function(){const e=$(this).text().replace(/[^\d]/g,""),i=parseInt(e,10);isNaN(i)||(t+=i)}));const e=t.toLocaleString("ru-RU").replace(/,/g," ");$(".main-total").text(e+" ₸")}function updateCartCount(){const t=JSON.parse(localStorage.getItem("cartItemsList"))||[];$(".cart-count-number").text(t.length)}$(document).ready((function(){checkFavoritesValidity();let t=JSON.parse(localStorage.getItem("favsItemsList"))||[];function e(t){const e=t.sizes&&t.sizes.length?`\n      <div class="side__item--size">\n        <span>${t.sizeTitle||"Размер"}: </span> \n        <div class="side__item--select" data-id="${t.id}">\n          <div class="side__item--current">${t.selectedSize}</div>\n          <div class="side__item--options">\n            ${t.sizes.map((e=>`\n              <div class="side__item--option ${e===t.selectedSize?"active":""}">${e}</div>\n            `)).join("")}\n          </div>\n        </div>\n      </div>\n    `:"",i=`\n      <div class="side__item" data-id="${t.id}">\n        <div class="side__item--img">\n          <picture>\n            <img src="${t.img}" alt="product">\n          </picture>\n        </div>\n        <div class="side__item--info">\n          <span>${t.code}</span>\n          <b>${t.name}</b>\n          ${e}\n          <p>${t.price}</p>\n        </div>\n        <div class="side__del">\n          <img src="/assets/img/icons/delete.svg" alt="icon">\n        </div>\n      </div>`;$(".favs__items").append(i)}function i(t){const e=t.find('input[type="radio"]:checked');if(e.length)return e.val();const i=t.find('input[type="radio"]').first();return i.length?i.val():null}function s(t){return t.find('input[type="radio"]').map((function(){return $(this).val()})).get()}t.forEach((t=>{e(t),$("#"+t.id).find(".add-to-fav").addClass("active")})),$(".fav-count-number").text(t.length),$(".add-to-fav").on("click",(function(i){i.preventDefault(),i.stopPropagation();const s=$(this).closest(".main-item"),a=s.attr("id"),r=t.findIndex((t=>t.id===a));if(-1!==r)t.splice(r,1),$(this).removeClass("active"),$('.side__item[data-id="'+a+'"]').remove();else{const i=function(t){return{id:t.attr("id"),img:t.find("picture img").attr("src"),name:t.find(".product0-name").text(),price:t.find(".product0-price").text(),code:t.find("span").first().text(),sizes:[],selectedSize:null}}(s);t.push(i),$(this).addClass("active"),e(i)}$(".fav-count-number").text(t.length),localStorage.setItem("favsItemsList",JSON.stringify(t))}));const a=$(".product__content"),r=a.attr("id");r&&t.find((t=>t.id===r))&&$(".product__fav").addClass("active"),$(".product__fav").on("click",(function(){const d=t.findIndex((t=>t.id===r));if(-1!==d)t.splice(d,1),$(this).removeClass("active"),$('.side__item[data-id="'+r+'"]').remove();else{const r={id:(n=a).attr("id"),img:n.find(".product__slider--item").first().find("picture img").attr("src")||"assets/img/noimage.jpg",name:n.find(".product__name").text().trim(),price:n.find(".product__price b").text().trim(),code:n.find(".product__art").text().replace("Артикул:","").trim(),sizes:s(n),selectedSize:i(n),sizeTitle:n.find(".product__size--title2").text().trim()||"Размер"};t.push(r),$(this).addClass("active"),e(r)}var n;$(".fav-count-number").text(t.length),localStorage.setItem("favsItemsList",JSON.stringify(t))})),$(document).on("click",".side__del",(function(){const e=$(this).closest(".side__item"),i=e.data("id");e.remove(),t=t.filter((t=>t.id!==i)),$(".fav-count-number").text(t.length),localStorage.setItem("favsItemsList",JSON.stringify(t)),$("#"+i).find(".add-to-fav").removeClass("active"),$(".product__fav").removeClass("active")})),$(document).on("click",".side__item--select, .side__item--current",(function(t){t.stopPropagation();const e=$(this).closest(".side__item--select");$(".side__item--options").not(e.find(".side__item--options")).hide(),e.find(".side__item--options").toggle()})),$(document).on("click",".side__item--size > span",(function(t){t.stopPropagation();const e=$(this).siblings(".side__item--select");$(".side__item--options").not(e.find(".side__item--options")).hide(),e.find(".side__item--options").toggle()})),$(document).on("click",".side__item--option",(function(t){t.stopPropagation();const e=$(this),i=e.text().trim(),s=e.closest(".side__item--select"),a=s.data("id");s.find(".side__item--option").removeClass("active"),e.addClass("active"),s.find(".side__item--current").text(i),s.find(".side__item--options").hide();let r=JSON.parse(localStorage.getItem("favsItemsList"))||[];const d=r.find((t=>t.id===a));d&&(d.selectedSize=i,localStorage.setItem("favsItemsList",JSON.stringify(r)))})),$(document).on("click",(function(){$(".side__item--options").hide()}))})),$(document).on("click",".order__del",(function(){const t=$(this).closest(".order__item"),e=t.data("id");t.remove();let i=JSON.parse(localStorage.getItem("cartItemsList"))||[];i=i.filter((t=>t.id!==e)),localStorage.setItem("cartItemsList",JSON.stringify(i)),$(`.side.cart .side__item[data-id="${e}"]`).remove(),updateCartCount(),updateCartTotal()})),$(document).ready((function(){function t(t){if($('.side.cart .side__item[data-id="'+t.id+'"]').length)return;const e=`\n      <div class="side__item" data-id="${t.id}">\n        <div class="side__item--img">\n          <picture>\n            <img src="${t.img}" alt="product">\n          </picture>\n        </div>\n        <div class="side__item--info">\n          <span>${t.code}</span>\n          <b>${t.name}</b>\n          ${t.selectedSize?`<div class="side__size">Размер ${t.selectedSize}</div>`:""}\n          <p>${t.price}</p>\n        </div>\n        <div class="side__del">\n          <img src="/assets/img/icons/delete.svg" alt="icon">\n        </div>\n      </div>\n    `;$(".side.cart .side__items").append(e)}(JSON.parse(localStorage.getItem("cartItemsList"))||[]).forEach((e=>t(e))),updateCartCount(),updateCartTotal(),checkCartValidity(),renderOrderItems();const e=$(".product__content");e.attr("id");$(".product__cart").on("click",(function(){const i={id:(s=e).attr("id"),img:s.find(".product__slider--item").first().find("picture img").attr("src")||"assets/img/noimage.jpg",code:s.find(".product__code").text(),name:s.find(".product__name").text(),selectedSize:s.find(".product__size--selected").text(),price:s.find(".product__price").text()};var s;let a=JSON.parse(localStorage.getItem("cartItemsList"))||[];a.some((t=>t.id===i.id))||(a.push(i),t(i),localStorage.setItem("cartItemsList",JSON.stringify(a)),updateCartCount(),updateCartTotal(),renderOrderItems())})),$(document).on("click",".side__btn",(function(){const e=JSON.parse(localStorage.getItem("favsItemsList"))||[];let i=JSON.parse(localStorage.getItem("cartItemsList"))||[];e.forEach((e=>{i.some((t=>t.id===e.id))||(i.push(e),t(e))})),localStorage.setItem("cartItemsList",JSON.stringify(i)),updateCartCount(),updateCartTotal(),renderOrderItems()})),$(document).on("click",".side.cart .side__del",(function(){const t=$(this).closest(".side__item"),e=t.data("id");t.remove();let i=JSON.parse(localStorage.getItem("cartItemsList"))||[];i=i.filter((t=>t.id!==e)),localStorage.setItem("cartItemsList",JSON.stringify(i)),updateCartCount(),updateCartTotal(),renderOrderItems()}))}));