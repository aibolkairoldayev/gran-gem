const baseApiUrl=window.location.origin.includes("localhost")?"http://localhost":"https://grangem-master-cvkurw.laravel.cloud";function checkFavoritesValidity(){let t=JSON.parse(localStorage.getItem("favsItemsList"))||[];if(!t.length)return;const e=t.map((t=>t.id)).join(",");$.ajax({url:`${baseApiUrl}/api/wishlist?products=${e}`,method:"GET",success:function(e){e.map((t=>String(t.id)));t=t.filter((t=>{const i=e.find((e=>String(e.id)===String(t.id)));if(i){if(i.has_price&&i.price_in_dollars){const e=t.price.replace(/[^\d.,]/g,"").replace(",","."),s=parseFloat(i.price_in_dollars).toFixed(2);parseFloat(e)!==parseFloat(s)&&(t.price=s,$(`.side__item[data-id="${t.id}"]`).find("p").text(s))}return!0}return $(`.side__item[data-id="${t.id}"]`).remove(),$(`#${t.id}`).find(".add-to-fav").removeClass("active"),$(".product__fav").removeClass("active"),!1})),localStorage.setItem("favsItemsList",JSON.stringify(t)),$(".fav-count-number").text(t.length)},error:function(){console.error("Не удалось проверить актуальность избранного")}})}$(document).ready((function(){checkFavoritesValidity()})),$(document).ready((function(){checkFavoritesValidity();let t=JSON.parse(localStorage.getItem("favsItemsList"))||[];function e(t){const e=t.sizes&&t.sizes.length?`\n      <div class="side__item--size">\n        <span>Размер: </span>\n        <div class="side__item--select" data-id="${t.id}">\n          <div class="side__item--current">${t.selectedSize}</div>\n          <div class="side__item--options">\n            ${t.sizes.map((e=>`\n              <div class="side__item--option ${e===t.selectedSize?"active":""}">${e}</div>\n            `)).join("")}\n          </div>\n        </div>\n      </div>\n    `:"",i=`\n      <div class="side__item" data-id="${t.id}">\n        <div class="side__item--img">\n          <picture>\n            <img src="${t.img}" alt="product">\n          </picture>\n        </div>\n        <div class="side__item--info">\n          <span>${t.code}</span>\n          <b>${t.name}</b>\n          ${e}\n          <p>${t.price}</p>\n        </div>\n        <div class="side__del">\n          <img src="assets/img/icons/delete.svg" alt="icon">\n        </div>\n      </div>`;$(".favs__items").append(i)}function i(t){const e=t.find('input[type="radio"]:checked');if(e.length)return e.val();const i=t.find('input[type="radio"]').first();return i.length?i.val():null}function s(t){return t.find('input[type="radio"]').map((function(){return $(this).val()})).get()}t.forEach((t=>{e(t),$("#"+t.id).find(".add-to-fav").addClass("active")})),$(".fav-count-number").text(t.length),$(".add-to-fav").on("click",(function(i){i.preventDefault(),i.stopPropagation();const s=$(this).closest(".main-item"),n=s.attr("id"),d=t.findIndex((t=>t.id===n));if(-1!==d)t.splice(d,1),$(this).removeClass("active"),$('.side__item[data-id="'+n+'"]').remove();else{const i=function(t){return{id:t.attr("id"),img:t.find("picture img").attr("src"),name:t.find(".product0-name").text(),price:t.find(".product0-price").text(),code:t.find("span").first().text(),sizes:[],selectedSize:null}}(s);t.push(i),$(this).addClass("active"),e(i)}$(".fav-count-number").text(t.length),localStorage.setItem("favsItemsList",JSON.stringify(t))}));const n=$(".product__content"),d=n.attr("id");d&&t.find((t=>t.id===d))&&$(".product__fav").addClass("active"),$(".product__fav").on("click",(function(){const c=t.findIndex((t=>t.id===d));if(-1!==c)t.splice(c,1),$(this).removeClass("active"),$('.side__item[data-id="'+d+'"]').remove();else{const d={id:(a=n).attr("id"),img:a.find(".product__slider--item").first().find("picture img").attr("src")||"assets/img/noimage.jpg",name:a.find(".product__name").text().trim(),price:a.find(".product__price b").text().trim(),code:a.find(".product__art").text().replace("Артикул:","").trim(),sizes:s(a),selectedSize:i(a)};t.push(d),$(this).addClass("active"),e(d)}var a;$(".fav-count-number").text(t.length),localStorage.setItem("favsItemsList",JSON.stringify(t))})),$(document).on("click",".side__del",(function(){const e=$(this).closest(".side__item"),i=e.data("id");e.remove(),t=t.filter((t=>t.id!==i)),$(".fav-count-number").text(t.length),localStorage.setItem("favsItemsList",JSON.stringify(t)),$("#"+i).find(".add-to-fav").removeClass("active"),$(".product__fav").removeClass("active")})),$(document).on("click",".side__item--select, .side__item--current",(function(t){t.stopPropagation();const e=$(this).closest(".side__item--select");$(".side__item--options").not(e.find(".side__item--options")).hide(),e.find(".side__item--options").toggle()})),$(document).on("click",".side__item--size > span",(function(t){t.stopPropagation();const e=$(this).siblings(".side__item--select");$(".side__item--options").not(e.find(".side__item--options")).hide(),e.find(".side__item--options").toggle()})),$(document).on("click",".side__item--option",(function(t){t.stopPropagation();const e=$(this),i=e.text().trim(),s=e.closest(".side__item--select"),n=s.data("id");s.find(".side__item--option").removeClass("active"),e.addClass("active"),s.find(".side__item--current").text(i),s.find(".side__item--options").hide();let d=JSON.parse(localStorage.getItem("favsItemsList"))||[];const c=d.find((t=>t.id===n));c&&(c.selectedSize=i,localStorage.setItem("favsItemsList",JSON.stringify(d)))})),$(document).on("click",(function(){$(".side__item--options").hide()}))})),$(document).ready((function(){function t(t){if($('.side.cart .side__item[data-id="'+t.id+'"]').length)return;const e=`\n      <div class="side__item" data-id="${t.id}">\n        <div class="side__item--img">\n          <picture>\n            <img src="${t.img}" alt="product">\n          </picture>\n        </div>\n        <div class="side__item--info">\n          <span>${t.code}</span>\n          <b>${t.name}</b>\n          ${t.selectedSize?`<div class="side__size">Размер ${t.selectedSize}</div>`:""}\n          <p>${t.price}</p>\n        </div>\n        <div class="side__del">\n          <img src="assets/img/icons/delete.svg" alt="icon">\n        </div>\n      </div>\n    `;$(".side.cart .side__items").append(e)}function e(){const t=JSON.parse(localStorage.getItem("cartItemsList"))||[];$(".cart-count-number").text(t.length)}function i(){let t=0;$(".side.cart .side__item--info p").each((function(){const e=$(this).text().replace(/[^\d]/g,""),i=parseInt(e,10);isNaN(i)||(t+=i)}));const e=t.toLocaleString("ru-RU").replace(/,/g," ");$(".main-total").text(e+" ₸")}(JSON.parse(localStorage.getItem("cartItemsList"))||[]).forEach((e=>t(e))),e(),i();const s=$(".product__content");s.attr("id");$(".product__cart").on("click",(function(){const n={id:(d=s).attr("id"),img:d.find(".product__slider--item").first().find("picture img").attr("src")||"assets/img/noimage.jpg",code:d.find(".product__code").text(),name:d.find(".product__name").text(),selectedSize:d.find(".product__size--selected").text(),price:d.find(".product__price").text()};var d;let c=JSON.parse(localStorage.getItem("cartItemsList"))||[];c.some((t=>t.id===n.id))||(c.push(n),t(n),localStorage.setItem("cartItemsList",JSON.stringify(c)),e(),i())})),$(document).on("click",".side__btn",(function(){const s=JSON.parse(localStorage.getItem("favsItemsList"))||[];let n=JSON.parse(localStorage.getItem("cartItemsList"))||[];s.forEach((e=>{n.some((t=>t.id===e.id))||(n.push(e),t(e))})),localStorage.setItem("cartItemsList",JSON.stringify(n)),e(),i()})),$(document).on("click",".side.cart .side__del",(function(){const t=$(this).closest(".side__item"),s=t.data("id");t.remove();let n=JSON.parse(localStorage.getItem("cartItemsList"))||[];n=n.filter((t=>t.id!==s)),localStorage.setItem("cartItemsList",JSON.stringify(n)),e(),i()}))}));