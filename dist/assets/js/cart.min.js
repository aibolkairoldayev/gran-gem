const baseApiUrl=window.location.origin.includes("localhost")?"http://localhost":"https://grangem-master-cvkurw.laravel.cloud";function formatPriceWithSpaces(t){return String(t).replace(/\B(?=(\d{3})+(?!\d))/g," ")}function checkFavoritesValidity(){let t=JSON.parse(localStorage.getItem("favsItemsList"))||[];if(!t.length)return;const e=t.map((t=>String(t.id).replace(/^product/i,"").replace(/^0+/,""))).join(",");$.ajax({url:`${baseApiUrl}/api/wishlist?products=${e}`,method:"GET",success:function(e){e.map((t=>String(t.id)));t=t.filter((t=>{const i=String(t.id).replace(/^product/i,"").replace(/^0+/,""),r=e.find((t=>String(t.id)===i));if(r){if(r.has_price&&r.price){const e=t.price.replace(/[^\d.,]/g,"").replace(",","."),i=String(r.price);parseFloat(e)!==parseFloat(i)&&(t.price=i,$(`.side__item[data-id="${t.id}"]`).find("p").text(formatPriceWithSpaces(i)))}return!0}return $(`.side__item[data-id="${t.id}"]`).remove(),$(`#${t.id}`).find(".add-to-fav").removeClass("active"),$(".product__fav").removeClass("active"),!1})),localStorage.setItem("favsItemsList",JSON.stringify(t)),$(".fav-count-number").text(t.length)},error:function(){console.error("Не удалось проверить актуальность избранного")}})}function formatPrice(t){return Number(t).toLocaleString("ru-RU").replace(/,/g," ")}function checkCartValidity(){let t=JSON.parse(localStorage.getItem("cartItemsList"))||[];if(!t.length)return;const e=t.map((t=>String(t.id).replace(/^product/i,"").replace(/^0+/,""))).join(",");$.ajax({url:`${baseApiUrl}/api/cart-products?products=${e}`,method:"GET",success:function(e){t=t.filter((t=>{const i=String(t.id).replace(/^product/i,"").replace(/^0+/,""),r=e.find((t=>String(t.id)===i));if(r){if(r.has_price&&r.price){const e=t.price.replace(/[^\d.,]/g,"").replace(",","."),i=String(r.price);parseFloat(e)!==parseFloat(i)&&(t.price=formatPrice(i)+" ₸",$(`.side.cart .side__item[data-id="${t.id}"]`).find("p").text(formatPrice(i)+" ₸"))}return!0}return $(`.side.cart .side__item[data-id="${t.id}"]`).remove(),!1})),localStorage.setItem("cartItemsList",JSON.stringify(t)),updateCartCount(),updateCartTotal()},error:function(){console.error("Не удалось проверить актуальность корзины")}})}function renderOrderItems(){let t=JSON.parse(localStorage.getItem("cartItemsList"))||[];if(!t.length)return;const e=$(".order__items");e.empty(),t.forEach((t=>{const i=t.price.replace(/[^\d.,]/g,"").replace(",","."),r=`\n      <div class="order__item" data-id="${t.id}">\n        <div class="order__img">\n          <picture><img src="${t.img}" alt="order"></picture>\n        </div>\n        <div class="order__info">\n          <span>${t.code}</span>\n          <div class="order__name">${t.name}</div>\n          <div class="order__drop"></div>\n          <div class="order__price">${formatPrice(i)} ₸</div>\n        </div>\n        <div class="order__del"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24">...</svg></div>\n      </div>\n    `;e.append(r)}));const i=t.map((t=>String(t.id).replace(/^product/i,"").replace(/^0+/,""))).join(",");$.ajax({url:`${baseApiUrl}/api/cart-products?products=${i}`,method:"GET",success:function(e){t=t.filter((t=>{const i=String(t.id).replace(/^product/i,"").replace(/^0+/,""),r=e.find((t=>String(t.id)===i));if(r){if(r.has_price&&r.price){const e=t.price.replace(/[^\d.,]/g,"").replace(",","."),i=String(r.price);parseFloat(e)!==parseFloat(i)&&(t.price=formatPrice(i)+" ₸",$(`.side.cart .side__item[data-id="${t.id}"]`).find("p").text(formatPrice(i)+" ₸"),$(`.order__item[data-id="${t.id}"]`).find(".order__price").text(formatPrice(i)+" ₸"))}return!0}return $(`.side.cart .side__item[data-id="${t.id}"]`).remove(),$(`.order__item[data-id="${t.id}"]`).remove(),!1})),localStorage.setItem("cartItemsList",JSON.stringify(t)),updateCartCount(),updateCartTotal()},error:function(){console.error("Не удалось проверить актуальность корзины")}})}function updateCartTotal(){let t=0;$(".side.cart .side__item--info p").each((function(){const e=$(this).text().replace(/[^\d]/g,""),i=parseInt(e,10);isNaN(i)||(t+=i)})),$(".main-total").text(formatPrice(t)+" ₸")}function updateCartCount(){const t=JSON.parse(localStorage.getItem("cartItemsList"))||[];$(".cart-count-number").text(t.length)}$(document).ready((function(){checkFavoritesValidity();let t=JSON.parse(localStorage.getItem("favsItemsList"))||[];function e(t){const e=t.sizes&&t.sizes.length?`\n      <div class="side__item--size">\n        <span>${t.sizeTitle||"Размер"}: </span> \n        <div class="side__item--select" data-id="${t.id}">\n          <div class="side__item--current">${t.selectedSize}</div>\n          <div class="side__item--options">\n            ${t.sizes.map((e=>`\n              <div class="side__item--option ${e===t.selectedSize?"active":""}">${e}</div>\n            `)).join("")}\n          </div>\n        </div>\n      </div>\n    `:"",i=`\n      <div class="side__item" data-id="${t.id}">\n        <div class="side__item--img">\n          <picture>\n            <img src="${t.img}" alt="product">\n          </picture>\n        </div>\n        <div class="side__item--info">\n          <span>${t.code}</span>\n          <b>${t.name}</b>\n          ${e}\n          <p>${formatPriceWithSpaces(t.price)}</p>\n        </div>\n        <div class="side__del">\n          <img src="/assets/img/icons/delete.svg" alt="icon">\n        </div>\n      </div>`;$(".favs__items").append(i)}function i(t){const e=t.find('input[type="radio"]:checked');if(e.length)return e.val();const i=t.find('input[type="radio"]').first();return i.length?i.val():null}function r(t){return t.find('input[type="radio"]').map((function(){return $(this).val()})).get()}t.forEach((t=>{e(t),$("#"+t.id).find(".add-to-fav").addClass("active")})),$(".fav-count-number").text(t.length),$(".add-to-fav").on("click",(function(i){i.preventDefault(),i.stopPropagation();const r=$(this).closest(".main-item"),s=r.attr("id"),a=t.findIndex((t=>t.id===s));if(-1!==a)t.splice(a,1),$(this).removeClass("active"),$('.side__item[data-id="'+s+'"]').remove();else{const i=function(t){return{id:t.attr("id"),img:t.find("picture img").attr("src"),name:t.find(".product0-name").text(),price:t.find(".product0-price").text(),code:t.find("span").first().text(),sizes:[],selectedSize:null}}(r);t.push(i),$(this).addClass("active"),e(i)}$(".fav-count-number").text(t.length),localStorage.setItem("favsItemsList",JSON.stringify(t))}));const s=$(".product__content"),a=s.attr("id");a&&t.find((t=>t.id===a))&&$(".product__fav").addClass("active"),$(".product__fav").on("click",(function(){const c=t.findIndex((t=>t.id===a));if(-1!==c)t.splice(c,1),$(this).removeClass("active"),$('.side__item[data-id="'+a+'"]').remove();else{const a={id:(n=s).attr("id"),img:n.find(".product__slider--item").first().find("picture img").attr("src")||"assets/img/noimage.jpg",name:n.find(".product__name").text().trim(),price:n.find(".product__price b").text().trim(),code:n.find(".product__art").text().replace("Артикул:","").trim(),sizes:r(n),selectedSize:i(n),sizeTitle:n.find(".product__size--title2").text().trim()||"Размер"};t.push(a),$(this).addClass("active"),e(a)}var n;$(".fav-count-number").text(t.length),localStorage.setItem("favsItemsList",JSON.stringify(t))})),$(document).on("click",".side__del",(function(){const e=$(this).closest(".side__item"),i=e.data("id");e.remove(),t=t.filter((t=>t.id!==i)),$(".fav-count-number").text(t.length),localStorage.setItem("favsItemsList",JSON.stringify(t)),$("#"+i).find(".add-to-fav").removeClass("active"),$(".product__fav").removeClass("active")})),$(document).on("click",".side__item--select, .side__item--current",(function(t){t.stopPropagation();const e=$(this).closest(".side__item--select");$(".side__item--options").not(e.find(".side__item--options")).hide(),e.find(".side__item--options").toggle()})),$(document).on("click",".side__item--size > span",(function(t){t.stopPropagation();const e=$(this).siblings(".side__item--select");$(".side__item--options").not(e.find(".side__item--options")).hide(),e.find(".side__item--options").toggle()})),$(document).on("click",".side__item--option",(function(t){t.stopPropagation();const e=$(this),i=e.text().trim(),r=e.closest(".side__item--select"),s=r.data("id");r.find(".side__item--option").removeClass("active"),e.addClass("active"),r.find(".side__item--current").text(i),r.find(".side__item--options").hide();let a=JSON.parse(localStorage.getItem("favsItemsList"))||[];const c=a.find((t=>t.id===s));c&&(c.selectedSize=i,localStorage.setItem("favsItemsList",JSON.stringify(a)))})),$(document).on("click",(function(){$(".side__item--options").hide()}))})),$(document).ready((function(){function t(t){if($(`.side.cart .side__item[data-id="${t.id}"]`).length)return;const e=t.price.replace(/[^\d.,]/g,"").replace(",","."),i=`\n      <div class="side__item" data-id="${t.id}">\n        <div class="side__item--img"><picture><img src="${t.img}" alt="product"></picture></div>\n        <div class="side__item--info">\n          <span>${t.code}</span>\n          <b>${t.name}</b>\n          ${t.selectedSize?`<div class="side__size">Размер ${t.selectedSize}</div>`:""}\n          <p>${formatPrice(e)} ₸</p>\n        </div>\n        <div class="side__del"><img src="/assets/img/icons/delete.svg" alt="icon"></div>\n      </div>\n    `;$(".side.cart .side__items").append(i)}(JSON.parse(localStorage.getItem("cartItemsList"))||[]).forEach((e=>t(e))),updateCartCount(),updateCartTotal(),checkCartValidity(),renderOrderItems();const e=$(".product__content");$(".product__cart").on("click",(function(){const i={id:(r=e).attr("id"),img:r.find(".product__slider--item picture img").attr("src")||"assets/img/noimage.jpg",code:r.find(".product__code").text(),name:r.find(".product__name").text(),selectedSize:r.find(".product__size--selected").text(),price:formatPrice(r.find(".product__price").text().replace(/[^\d.,]/g,"").replace(",","."))+" ₸"};var r;let s=JSON.parse(localStorage.getItem("cartItemsList"))||[];s.some((t=>t.id===i.id))||(s.push(i),t(i),localStorage.setItem("cartItemsList",JSON.stringify(s)),updateCartCount(),updateCartTotal(),renderOrderItems())})),$(document).on("click",".side__btn",(function(){const e=JSON.parse(localStorage.getItem("favsItemsList"))||[];let i=JSON.parse(localStorage.getItem("cartItemsList"))||[];e.forEach((e=>{i.some((t=>t.id===e.id))||(i.push(e),t(e))})),localStorage.setItem("cartItemsList",JSON.stringify(i)),updateCartCount(),updateCartTotal(),renderOrderItems()})),$(document).on("click",".side.cart .side__del",(function(){const t=$(this).closest(".side__item"),e=t.data("id");t.remove();let i=JSON.parse(localStorage.getItem("cartItemsList"))||[];i=i.filter((t=>t.id!==e)),localStorage.setItem("cartItemsList",JSON.stringify(i)),updateCartCount(),updateCartTotal(),renderOrderItems()})),$(document).on("click",".order__del",(function(){const t=$(this).closest(".order__item"),e=t.data("id");t.remove();let i=JSON.parse(localStorage.getItem("cartItemsList"))||[];i=i.filter((t=>t.id!==e)),localStorage.setItem("cartItemsList",JSON.stringify(i)),$(`.side.cart .side__item[data-id="${e}"]`).remove(),updateCartCount(),updateCartTotal()}))})),$(document).ready((function(){function t(t){return Number(t).toLocaleString("ru-RU").replace(/,/g," ")}if($(".product").length){const e=$(".product__content"),i=parseInt(e.attr("id").replace(/\D/g,""),10),r=$.trim($(".product__name").text()),s=window.location.href;let a=$(".product__img--big").attr("src");a||(a=$(".product__slider--item picture img").first().attr("src"));const c=$(".product__art").text().match(/\d+/),n=c?c[0]:"",d=$(".product__price b").text().replace(/\D/g,""),o=d?t(d):"",l=localStorage.getItem("favsItemsList");let p=[];if(l)try{p=JSON.parse(l)}catch(t){}const m=p.some((t=>parseInt(t.id.replace(/\D/g,""),10)===i)),_={id:i,name:r,link:s,img:a,art:n,price:o,fav:m},u=localStorage.getItem("watchItemsList");let f=[];if(u)try{f=JSON.parse(u)}catch(t){}f=f.filter((t=>parseInt(t.id,10)!==i)),f.push(_),localStorage.setItem("watchItemsList",JSON.stringify(f));const g=$(".watch"),v=$(".category__items.category__items3");v.empty();const S=f.filter((t=>parseInt(t.id,10)!==i)).slice(-4).reverse();0===S.length?g.hide():(g.show(),S.forEach((e=>{const i=e.fav?" active":"",r=e.price?`${t(e.price.replace(/[^\d.,]/g,"").replace(",","."))} ₸`:"Цена по запросу",s=`\n                <a href="${e.link}" class="category__item product0 main-item" id="product${e.id}">\n                    <div class="block__item--favs main-item__favs add-to-fav${i}">\n                        <img class="fav--empty" src="/assets/img/icons/favs.svg" alt="cart">\n                        <img class="fav--full" src="/assets/img/icons/favs3.svg" alt="cart">\n                    </div>\n                    <div class="category__item--img">\n                        <picture>\n                            <img class="product0-img" src="${e.img}" alt="product">\n                        </picture>\n                    </div>\n                    <div class="category__item--info">\n                        <span class="product0-art">${e.art}</span>\n                        <b class="product0-name">${e.name}</b>\n                        <p class="product0-price">${r}</p>\n                    </div>\n                </a>\n                `;v.append(s)})))}}));